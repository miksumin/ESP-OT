## ESP-Opentherm
ESP-OT это проект контроллера на основе ESP8266/ESP32 для управления работой котла с помощью адаптера (http://ihormelnyk.com/opentherm_adapter)
или его самодельных аналогов и протокола Opentherm (http://ihormelnyk.com/opentherm_library). 

Полная версия прошивки (как и версия Free) использует гибкий или "обучаемый" алгоритм взаимодействия с котлом.

После старта прошивки происходит однократный опрос всех ID, описанных в протоколе Opentherm, на предмет получения разумного ответа от котла и маркировкой ID, на которые котел не отвечает. В дальнейшей работе с котлом используются только такие "читаемые" ID. Таким образом код прошивки подстраивается под конкретную модель котла.
Первичный опрос занимает около 15 сек, но работа основного цикла при этом не блокируется, т.к. все запросы делаются в асинхронном режиме.
Алгоритм опроса "читаемых" ID настраивается в коде указанием интервала опроса для каждого ID, либо указанием необходимости только однократного опроса.

## Пример кода - версия Lite
В папке \ESP-OT-Lite находится исходный код версии Lite, использующей ядро v1. Скетч обеспечивает подключение к WiFi сети и взаимодействие с котлом по стандартному алгоритму последовательного опроса необходимых ID, включая веб-интерфейс для отображения данных и управления настройками котла. Данный код при желании может быть самостоятельно доработан под свои потребности. Здесь же можно найти собранный вариант такой прошивки для контроллера Wemos D1 mini / NodeMCU. Подключение адаптера стандартное.
. 
Расшифровка ответов котла в приведенном коде сделана только для тех ID, которые поддерживает мой котел Buderus Logamax U072. 
Расшифровка других ID может быть добавлена самостоятельно. В частности, в процессе тестирования выяснилось, что мой котел поддерживает запрос "Fan Speed" (ID35), 
которого нет в описании протокола Opentherm. 

Получить отчет о конфигурации вашего котла, а также о поддерживаемых ID, возможно с помощью кнопки "Opentherm report" в бесплатной версии прошивки.

## Версия для свободного использования
В папке \ESP-OT-Free находится собранный и готовый для работы вариант прошивки для тестирования, обеспечивающий подключение к выбранной WiFi сети, 
отображение и ручное управление основными параметрами работы котла через встроенный веб-интерфейс, формирование отчета поддерживаемых котлом DataID, 
отображение и управление параметрами работы котла и термостата. Единственное ограничение - рестарт прошивки каждые 24 часа без сохранения текущих настроек.

ESP-OT-Free.D1-mini.bin - прошивка для контроллера Wemos D1 mini (NodeMCU). Подключение OT адаптера: выход адаптера (входной сигнал контроллера от котла) - пин D2 (GPIO-04), 
вход адаптера (выходной сигнал контроллера на котел) - пин D1 (GPIO-05). Подключение датчика DS18B20 - пин D5 (GPIO-14). Период опроса датчикаи интервал расчета термостата 30 сек.

ESP-OT-Free.D1-mini32.bin - прошивка для контроллера ESP32 D1 mini. Подключение OT адаптера: выход адаптера (входной сигнал контроллера от котла) - пин GPIO-21, вход адаптера (выходной сигнал контроллера на котел) - пин GPIO-22. Подключение датчика DS18B20 - пин GPIO-18. Период опроса датчика и интервал расчета термостата 30 сек.

После запуска прошивки делается попытка использовать данные последнего удачного подключения к WiFi сети (моргает светодиод).
При отсутствии таких данных, либо при невозможности подключения запускается режим точки доступа (горит светодиод), пароль 12345678.
В дальнейшем возможно подключение к другой WiFi сети с помощью веб-страницы "Configure WiFi".
Прошивка также может быть собрана для других типов контроллеров.


